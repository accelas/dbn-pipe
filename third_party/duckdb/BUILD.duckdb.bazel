# DuckDB pre-built binary distribution
# Uses pre-compiled shared library to avoid memory-intensive compilation

cc_import(
    name = "duckdb_lib",
    shared_library = "libduckdb.so",
)

cc_library(
    name = "duckdb",
    hdrs = ["duckdb.hpp", "duckdb.h"],
    includes = ["."],
    deps = [":duckdb_lib"],
    linkopts = [
        "-lpthread",
        "-ldl",
    ],
    visibility = ["//visibility:public"],
)

# Runtime shared library that consumers must bundle with their binaries.
# Usage in consumer's BUILD.bazel:
#
#   pkg_tar(
#       name = "myapp_tar",
#       srcs = [...],
#       deps = ["@duckdb//:duckdb_runtime_tar"],
#   )
filegroup(
    name = "duckdb_runtime",
    srcs = ["libduckdb.so"],
    visibility = ["//visibility:public"],
)

load("@rules_pkg//pkg:tar.bzl", "pkg_tar")

# Tarball with libduckdb.so at root - consumers should add their own package_dir
pkg_tar(
    name = "duckdb_runtime_tar",
    srcs = [":duckdb_runtime"],
    visibility = ["//visibility:public"],
)
