# DuckDB amalgamation build
# This builds DuckDB from the single-file amalgamation (duckdb.hpp + duckdb.cpp)

cc_library(
    name = "duckdb",
    srcs = ["duckdb.cpp"],
    hdrs = ["duckdb.hpp"],
    includes = ["."],
    # DuckDB requires C++17 minimum
    copts = [
        "-std=c++17",
        "-DDUCKDB_BUILD_LIBRARY",
        # Disable extensions we don't need for simple storage
        "-DDUCKDB_NO_THREADS",
        # Reduce compiler memory usage (critical for CI with limited RAM)
        "-fno-var-tracking",
        "-fno-var-tracking-assignments",
    ],
    linkopts = [
        "-lpthread",
        "-ldl",
    ],
    visibility = ["//visibility:public"],
)
